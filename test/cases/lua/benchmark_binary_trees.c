#include "test.lua.h"

TEST_F(lua, DISABLED_benchmark_binary_trees)
{
	static const char* script =
"-- The Computer Language Benchmarks Game\n"
"-- https://salsa.debian.org/benchmarksgame-team/benchmarksgame/\n"
"-- contributed by Mike Pall\n"
"-- *reset*\n"
"\n"
"local function BottomUpTree(depth)\n"
"  if depth > 0 then\n"
"    depth = depth - 1\n"
"    local left, right = BottomUpTree(depth), BottomUpTree(depth)\n"
"    return { left, right }\n"
"  else\n"
"    return { }\n"
"  end\n"
"end\n"
"\n"
"local function ItemCheck(tree)\n"
"  if tree[1] then\n"
"    return 1 + ItemCheck(tree[1]) + ItemCheck(tree[2])\n"
"  else\n"
"    return 1\n"
"  end\n"
"end\n"
"\n"
"local N = tonumber(arg and arg[1]) or 0\n"
"local mindepth = 4\n"
"local maxdepth = mindepth + 2\n"
"if maxdepth < N then maxdepth = N end\n"
"\n"
"do\n"
"  local stretchdepth = maxdepth + 1\n"
"  local stretchtree = BottomUpTree(stretchdepth)\n"
"  io.write(string.format(\"stretch  tree of depth %d\\t check: %d\\n\",\n"
"    stretchdepth, ItemCheck(stretchtree)))\n"
"end\n"
"\n"
"local longlivedtree = BottomUpTree(maxdepth)\n"
"\n"
"for depth=mindepth,maxdepth,2 do\n"
"  local iterations = 2 ^ (maxdepth - depth + mindepth)\n"
"  local check = 0\n"
"  for i=1,iterations do\n"
"    check = check + ItemCheck(BottomUpTree(depth))\n"
"  end\n"
"  io.write(string.format(\"%d\\t trees of depth %d\\t check: %d\\n\",\n"
"    iterations, depth, check))\n"
"end\n"
"\n"
"io.write(string.format(\"long lived tree of depth %d\\t check: %d\\n\",\n"
"  maxdepth, ItemCheck(longlivedtree)))\n";

	TEST_CALL_LUA(script, "21");
}
